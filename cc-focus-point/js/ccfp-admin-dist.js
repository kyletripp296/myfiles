!function(){"use strict";function u(t,e,i){for(var a=i.data,n=i.width,o=~~t.x,r=~~(t.x+t.width),s=~~t.y,d=~~(t.y+t.height),h=255*t.weight,c=s;c<d;c++)for(var u=o;u<r;u++){a[4*(c*n+u)+3]+=h}}function p(t,e,i){for(var a={detail:0,saturation:0,skin:0,boost:0,total:0},n=e.data,o=t.scoreDownSample,r=1/o,s=e.height*o,d=e.width*o,h=e.width,c=0;c<s;c+=o)for(var u=0;u<d;u+=o){var p=4*(~~(c*r)*h+~~(u*r)),g=m(t,i,u,c),f=n[p+1]/255;a.skin+=n[p]/255*(f+t.skinBias)*g,a.detail+=f*g,a.saturation+=n[p+2]/255*(f+t.saturationBias)*g,a.boost+=n[p+3]/255*g}return a.total=(a.detail*t.detailWeight+a.skin*t.skinWeight+a.saturation*t.saturationWeight+a.boost*t.boostWeight)/(i.width*i.height),a}function m(t,e,i,a){if(e.x>i||i>=e.x+e.width||e.y>a||a>=e.y+e.height)return t.outsideImportance;i=(i-e.x)/e.width,a=(a-e.y)/e.height;var n=2*C(.5-i),o=2*C(.5-a),r=Math.max(n-1+t.edgeRadius,0),s=Math.max(o-1+t.edgeRadius,0),d=(r*r+s*s)*t.edgeWeight,h=1.41-M(n*n+o*o);return t.ruleOfThirds&&(h+=1.2*Math.max(0,h+d+.5)*(c(n)+c(o))),h+d}function h(t,e){var i={},a=new y(e.width,e.height);!function(t,e){for(var i=t.data,a=e.data,n=t.width,o=t.height,r=0;r<o;r++)for(var s=0;s<n;s++){var d,h=4*(r*n+s);d=0===s||n-1<=s||0===r||o-1<=r?l(i,h):4*l(i,h)-l(i,h-4*n)-l(i,h-4)-l(i,h+4)-l(i,h+4*n),a[h+1]=d}}(e,a),function(t,e,i){for(var a,n,o,r,s,d,h,c,u=e.data,p=i.data,g=e.width,f=e.height,m=0;m<f;m++)for(var l=0;l<g;l++){var v=4*(m*g+l),w=k(u[v],u[v+1],u[v+2])/255,b=(a=t,n=u[v],o=u[v+1],r=u[v+2],s=M(n*n+o*o+r*r),d=n/s-a.skinColor[0],h=o/s-a.skinColor[1],c=r/s-a.skinColor[2],1-M(d*d+h*h+c*c)),x=b>t.skinThreshold,y=w>=t.skinBrightnessMin&&w<=t.skinBrightnessMax;p[v]=x&&y?(b-t.skinThreshold)*(255/(1-t.skinThreshold)):0}}(t,e,a),function(t,e,i){for(var a=e.data,n=i.data,o=e.width,r=e.height,s=0;s<r;s++)for(var d=0;d<o;d++){var h=4*(s*o+d),c=k(a[h],a[h+1],a[h+2])/255,u=v(a[h],a[h+1],a[h+2]),p=u>t.saturationThreshold,g=c>=t.saturationBrightnessMin&&c<=t.saturationBrightnessMax;n[h+2]=g&&p?(u-t.saturationThreshold)*(255/(1-t.saturationThreshold)):0}}(t,e,a),function(t,e){if(t.boost){for(var i=e.data,a=0;a<e.width;a+=4)i[a+3]=0;for(a=0;a<t.boost.length;a++)u(t.boost[a],0,e)}}(t,a);for(var n=g(a,t.scoreDownSample),o=-1/0,r=null,s=function(t,e,i){for(var a=[],n=b(e,i),o=t.cropWidth||n,r=t.cropHeight||n,s=t.maxScale;s>=t.minScale;s-=t.scaleStep)for(var d=0;d+r*s<=i;d+=t.step)for(var h=0;h+o*s<=e;h+=t.step)a.push({x:h,y:d,width:o*s,height:r*s});return a}(t,e.width,e.height),d=0,h=s.length;d<h;d++){var c=s[d];c.score=p(t,n,c),c.score.total>o&&(o=(r=c).score.total)}return i.topCrop=r,t.debug&&r&&(i.crops=s,i.debugOutput=a,i.debugOptions=t,i.debugTopCrop=f({},i.topCrop)),i}function y(t,e,i){this.width=t,this.height=e,this.data=i?new Uint8ClampedArray(i):new Uint8ClampedArray(t*e*4)}function g(t,e){for(var i=t.data,a=t.width,n=Math.floor(t.width/e),o=Math.floor(t.height/e),r=new y(n,o),s=r.data,d=1/(e*e),h=0;h<o;h++)for(var c=0;c<n;c++){for(var u=4*(h*n+c),p=0,g=0,f=0,m=0,l=0,v=0,w=0;w<e;w++)for(var b=0;b<e;b++){var x=4*((h*e+w)*a+(c*e+b));p+=i[x],g+=i[x+1],f+=i[x+2],m+=i[x+3],l=Math.max(l,i[x]),v=Math.max(v,i[x+1])}s[u]=p*d*.5+.5*l,s[u+1]=g*d*.7+.3*v,s[u+2]=f*d,s[u+3]=m*d}return r}function e(t,e){var i=document.createElement("canvas");return i.width=t,i.height=e,i}function n(o){return{open:function(t){var e=t.naturalWidth||t.width,i=t.naturalHeight||t.height,a=o(e,i),n=a.getContext("2d");return!t.naturalWidth||t.naturalWidth==t.width&&t.naturalHeight==t.height?(a.width=t.width,a.height=t.height):(a.width=t.naturalWidth,a.height=t.naturalHeight),n.drawImage(t,0,0),w.Promise.resolve(a)},resample:function(t,i,a){return Promise.resolve(t).then(function(t){var e=o(~~i,~~a);return e.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,e.width,e.height),w.Promise.resolve(e)})},getData:function(t){return Promise.resolve(t).then(function(t){var e=t.getContext("2d").getImageData(0,0,t.width,t.height);return new y(t.width,t.height,e.data)})}}}function f(t){for(var e=1,i=arguments.length;e<i;e++){var a=arguments[e];if(a)for(var n in a)t[n]=a[n]}return t}function c(t){return t=16*((t-1/3+1)%2*.5-.5),Math.max(1-t*t,0)}function k(t,e,i){return.5126*i+.7152*e+.0722*t}function l(t,e){return k(t[e],t[e+1],t[e+2])}function v(t,e,i){var a=x(t/255,e/255,i/255),n=b(t/255,e/255,i/255);if(a===n)return 0;var o=a-n;return.5<(a+n)/2?o/(2-a-n):o/(a+n)}var w={};w.Promise="undefined"!=typeof Promise?Promise:function(){throw new Error("No native promises and smartcrop.Promise not set.")},w.DEFAULTS={width:0,height:0,aspect:0,cropWidth:0,cropHeight:0,detailWeight:.2,skinColor:[.78,.57,.44],skinBias:.01,skinBrightnessMin:.2,skinBrightnessMax:1,skinThreshold:.8,skinWeight:1.8,saturationBrightnessMin:.05,saturationBrightnessMax:.9,saturationThreshold:.4,saturationBias:.2,saturationWeight:.1,scoreDownSample:8,step:8,scaleStep:.1,minScale:1,maxScale:1,edgeRadius:.4,edgeWeight:-20,outsideImportance:-.5,boostWeight:100,ruleOfThirds:!0,prescale:!0,imageOperations:null,canvasFactory:e,debug:!1},w.crop=function(t,e,r){var s=f({},w.DEFAULTS,e);s.aspect&&(s.width=s.aspect,s.height=1),null===s.imageOperations&&(s.imageOperations=n(s.canvasFactory));var i=s.imageOperations,a=1,d=1;return i.open(t,s.input).then(function(t){return s.width&&s.height&&(a=b(t.width/s.width,t.height/s.height),s.cropWidth=~~(s.width*a),s.cropHeight=~~(s.height*a),s.minScale=b(s.maxScale,x(1/a,s.minScale)),!1!==s.prescale&&((d=b(x(256/t.width,256/t.height),1))<1?(t=i.resample(t,t.width*d,t.height*d),s.cropWidth=~~(s.cropWidth*d),s.cropHeight=~~(s.cropHeight*d),s.boost&&(s.boost=s.boost.map(function(t){return{x:~~(t.x*d),y:~~(t.y*d),width:~~(t.width*d),height:~~(t.height*d),weight:t.weight}}))):d=1)),t}).then(function(t){return i.getData(t).then(function(t){for(var e=h(s,t),i=e.crops||[e.topCrop],a=0,n=i.length;a<n;a++){var o=i[a];o.x=~~(o.x/d),o.y=~~(o.y/d),o.width=~~(o.width/d),o.height=~~(o.height/d)}return r&&r(e),e})})},w.isAvailable=function(t){if(!w.Promise)return!1;if((t?t.canvasFactory:e)===e&&!document.createElement("canvas").getContext("2d"))return!1;return!0},w.importance=m,w.ImgData=y,w._downSample=g,w._canvasImageOperations=n;var b=Math.min,x=Math.max,C=Math.abs,M=Math.sqrt;"undefined"!=typeof define&&define.amd&&define(function(){return w}),"undefined"!=typeof exports?exports.smartcrop=w:"undefined"!=typeof navigator&&(window.SmartCrop=window.smartcrop=w),"undefined"!=typeof module&&(module.exports=w)}(),function(r){function t(){i=setInterval(function(){var t;r(".imgedit-menu").length&&(clearInterval(i),r(".imgedit-focus").length||(r('<button type="button" class="imgedit-focus button">Set Focus Point</button>').prependTo(".imgedit-menu"),r('<div class="focus-wrapper">').prependTo(".imgedit-crop-wrap"),r(".imgedit-crop-wrap img").appendTo(".focus-wrapper"),r('<div class="focus"></div>').appendTo(".focus-wrapper"),r('<input type="button" class="button button-primary imgedit-focus-submit-btn" disabled="disabled" value="Save">').appendTo(".imgedit-panel-content .imgedit-submit"),r(".focus-wrapper img").addClass("focused-image")),t={action:"get_coords",post_id:r(".imgedit-wrap > div").attr("id").replace("imgedit-panel-","")},r.post(ajaxURL,t,function(t){var e=JSON.parse(t);c.x=e.x,c.y=e.y,d(),r(".hide-edit").length&&r(".imgedit-focus")[0].click()}))},100)}function s(t,e,i){var a={action:"save_coords",post_id:t,x:e,y:i};r.post(ajaxURL,a,function(t){var e;JSON.parse(t);(e=r(".imgedit-focus-submit-btn")).length&&e.attr("disabled","disabled")})}function e(){var t=h.x,e=h.y,i=r(".focus-wrapper").offset().left,a=r(".focus-wrapper").offset().top,n=r(".focus-wrapper").width(),o=r(".focus-wrapper").height();c.x=((t-i)/n*100).toFixed(2),c.y=((e-a)/o*100).toFixed(2),100<c.x&&(c.x=100),c.x<0&&(c.x=0),100<c.y&&(c.y=100),c.y<0&&(c.y=0),r(".imgedit-focus-submit-btn").removeAttr("disabled"),d()}function d(){r(".focus-wrapper .focus").css({left:c.x+"%",top:c.y+"%"})}var i=!1,h={x:0,y:0},c={x:"0",y:"0"},a=!1;r.extend(wp.Uploader.prototype,{success:function(t){t.attributes.mime.match("image/")&&(r("#smartcrop").length||r('<div id="smartcrop" style="display:none;"></div>').appendTo("body"),r('<img src="'+t.attributes.url+'" width="'+t.attributes.width+'" height="'+t.attributes.height+'" data-id="'+t.id+'" />').appendTo("#smartcrop"),i=setInterval(function(){var t=r("#smartcrop img")[0];t.complete&&0!==t.naturalWidth&&(clearInterval(i),r("#smartcrop img").each(function(){var a=this.getAttribute("data-id"),n=parseInt(this.getAttribute("width")),o=parseInt(this.getAttribute("height")),t=n<o?n:o,e={width:t,height:t};smartcrop.crop(this,e,function(t){var e=(100*(t.topCrop.x+t.topCrop.width/2)/n).toFixed(2),i=(100*(t.topCrop.y+t.topCrop.height/2)/o).toFixed(2);s(a,e,i),r('#smartcrop img[data-id="'+a+'"]').remove()})}))},100))}}),r(document).on("click",'input[id^="imgedit-open-btn"], .button.edit-attachment, a.edit-attachment',function(){t()}),r(document).on("click",".set-focus-point",function(t){t.preventDefault(),r(".media-frame, .edit-attachment-frame").addClass("hide-edit");var e=r(".edit-attachment");e.length&&e[0].click()}),r(document).on("click",".acf-gallery-side .set-focus-point",function(t){t.preventDefault(),r(".acf-gallery-edit")[0].click(),i=setInterval(function(){r(".media-sidebar .set-focus-point").length&&(clearInterval(i),r(".media-sidebar .set-focus-point")[0].click())},100)}),r(document).on("click",".imgedit-cancel-btn",function(){r(".hide-edit").removeClass("hide-edit")}),r(document).on("click",".imgedit-focus",function(){r(".imgedit-panel-content").addClass("setfocus")}),r(document).on("click",".imgedit-menu > button:not(.imgedit-focus)",function(){r(".imgedit-panel-content").removeClass("setfocus")}),r(document).on("click",".imgedit-focus-submit-btn",function(){s(r(".imgedit-wrap > div").attr("id").replace("imgedit-panel-",""),c.x,c.y)}),r(document).on("mousemove",function(t){h.x=t.pageX,h.y=t.pageY,a&&e()}),r(document).on("mousedown",".focus-wrapper",function(t){1==t.which&&(e(),a=!0)}),r(document).on("mouseup",".focus-wrapper",function(t){1==t.which&&(a=!1)})}(jQuery);